# Battery Telemetry Prediction Pipeline

ë³¸ í”„ë¡œì íŠ¸ëŠ” BMS(ë°°í„°ë¦¬ ê´€ë¦¬ ì‹œìŠ¤í…œ) ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **SOC(State of Charge)**, **íŒ© ê°€ìš© ì¶œë ¥(Pack Available Power)**, **ì˜¨ë„ ì‹œí€€ìŠ¤(High/Avg/Low)**ë¥¼ ë‹¤ì¤‘ íšŒê·€ë¡œ ì˜ˆì¸¡í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤.  
**TCN / LSTM / Transformer** ë°±ë³¸ì„ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì „ì²˜ë¦¬ â†’ ë¼ë²¨ ìƒì„± â†’ í•™ìŠµ â†’ í‰ê°€ â†’ ì¶”ë¡ ì˜ ì „ ê³¼ì •ì„ ìë™í™”í•©ë‹ˆë‹¤.

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°
src/
 â”œâ”€ preprocess.py       # ì „ì²˜ë¦¬ (Raw CSV â†’ merged_clean.csv)
 â”œâ”€ labels.py           # ë¼ë²¨ ìƒì„± (NPZ)
 â”œâ”€ train.py            # í•™ìŠµ
 â”œâ”€ evaluate.py         # ìƒì„¸ í‰ê°€
 â”œâ”€ infer.py            # ê°„ì´ ì¶”ë¡ 
 â””â”€ models/             # ëª¨ë¸ ì•„í‚¤í…ì²˜
     â”œâ”€ tcn.py
     â”œâ”€ lstm.py
     â”œâ”€ transformer.py
     â”œâ”€ heads.py
     â”œâ”€ registry.py
     â””â”€ __init__.py

---

## âš™ï¸ ì£¼ìš” ê¸°ëŠ¥
- **ì „ì²˜ë¦¬**
  - ì‹œê°„ íŒŒì‹±, ê³ ì • ê°„ê²© ë¦¬ìƒ˜í”Œ, ì „ë ¥/ì˜¨ë„ ì§‘ê³„
  - ì´ìƒì¹˜ ì œê±°(EWMA+robust z-score)
  - Yeoâ€“Johnson ë³€í™˜, ì°¨ë¶„, ìŠ¤ì¼€ì¼ë§
- **ë¼ë²¨ ìƒì„±**
  - SOC, Temp ì‹œí€€ìŠ¤
  - ì…€ ê°€ìš© ì¶œë ¥(P_cell): R0â€“SOC ë³´ê°„ + ì˜¨ë„ ë³´ì • + ì—´í—ˆìš©ì¹˜ ë°˜ì˜
- **í•™ìŠµ**
  - ë‹¤ì¤‘íƒœìŠ¤í¬ ì†ì‹¤: SOC + Temp(3ch) + P_cell
  - AMP ì§€ì›, ì²´í¬í¬ì¸íŠ¸ ì €ì¥
- **ìƒì„¸ í‰ê°€**
  - MAE/RMSE/RÂ²/MAPE, ìƒê´€ê³„ìˆ˜, KS-test
  - per-horizon / ì„¸ì…˜ë³„ / ì¡°ê±´ë³„ breakdown
  - ì‹œê°í™” í”Œë¡¯ ì €ì¥
- **ê°„ì´ ì¶”ë¡ **
  - ì˜ˆì¸¡Â·ì‹¤ì œ ë¹„êµ CSV, MAE ìš”ì•½
  - íŒ© ì¶œë ¥ í™˜ì‚°, ì§€ì†ê°€ëŠ¥ ì¶œë ¥ ìº¡(ì˜µì…˜)

---

## ğŸ“¦ ì„¤ì¹˜
git clone <repo_url>
cd <repo_dir>
pip install -r requirements.txt

---

## ğŸš€ ì‹¤í–‰ ìˆœì„œ

### 1. ì „ì²˜ë¦¬
python -m src.preprocess --config config.yaml
- ì…ë ¥: data/raw/*.csv (BMS ë°ì´í„°, Time ì»¬ëŸ¼ í•„ìˆ˜)
- ì¶œë ¥: data/interim/merged_clean.csv, artifacts/scalers/input_*.pkl

### 2. ë¼ë²¨ ìƒì„±
python -m src.labels --config config.yaml
- ì¶œë ¥: data/processed/dataset_windows_labels.npz

### 3. í•™ìŠµ
python -m src.train --config config.yaml --model_name tcn
- model_name: tcn | lstm | transformer
- ì¶œë ¥: artifacts/<model>/models/multitask_<model>_cellkW.pt

### 4. ìƒì„¸ í‰ê°€
python -m src.evaluate --config config.yaml --model_name tcn --split val
- split: train | val | test
- ì¶œë ¥: artifacts/<model>/<split>/metrics_ext.json, per_horizon_mae.csv, í”Œë¡¯ ì´ë¯¸ì§€

### 5. ê°„ì´ ì¶”ë¡ 
python -m src.infer --config config.yaml --model_name tcn --split val   --d_rem_km 10 --v_avg_kmh 50 --sprint 1.2 --eta_pack 0.95 --safety_factor 0.9
- ì¶œë ¥: preds_<split>.csv, mae_summary_<split>.json

---

## ğŸ“Š ëª¨ë¸ êµ¬ì¡°
- **ë°±ë³¸**
  - TCN: Dilated causal Conv1d ê¸°ë°˜
  - LSTM: ìˆœë°©í–¥ LSTM
  - Transformer: Positional Encoding + Encoder Layer
- **í—¤ë“œ(MultiTaskHeads)**
  - SOC / P_cell: ì „ì—­ í”¼ì²˜
  - Temp: ì‹œí€€ìŠ¤ í”¼ì²˜(High/Avg/Low)

---

## ğŸ—‚ config.yaml ì˜ˆì‹œ
data:
  raw_dir: data/raw
  interim_dir: data/interim
  processed_dir: data/processed
  r0_soc_file: data/raw/R0_SOC.csv
  sessions_train: ["2024A", "2024B"]
  sessions_val: ["2024C"]

window:
  dt: 0.25
  past_seconds: 15
  horizon_seconds: 5

pack:
  Ns: 14
  Np: 1
  V_nom_cell: 3.7
  V_min_cell: 3.0
  E_pack_kWh: 5.0
  P_loss_max_cell: 5.0